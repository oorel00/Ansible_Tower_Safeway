#
# OO script to change UNIX user password, OO_change_unix_pw <Password> <UserID>
# 11/13/2019 - oorel00 - Convert from HPOO to Ansible
# Arguments: $NEWPASS $CURUSER
#

#!/bin/ksh
PATH=/sbin:/bin:/usr/sbin:/usr/bin
NEWPASS=$1
CURUSER=$2
OStype=`uname`

case $OStype in

        'Linux')
        sname=`basename "$0"`
        echo "OStype checker has determined this system is: Linux"
        timestamp=`date`
        grep ${CURUSER} /etc/passwd 1>/dev/null 2>&1
        if [ $? != 0 ];then
        echo " `hostname`,UserID does not exist on the system"
        exit 0
        else
        echo ${NEWPASS} | passwd --stdin ${CURUSER} 1>/dev/null 2>&1
        chage -d 0 ${CURUSER} 1>/dev/null 2>&1
        echo " `hostname`,Password Changed Successfully"
        cat << EOF | mailx -s "Password reset : $(hostname) - ${sname} " "${CURUSER}@safeway.com"
${CURUSER},
Your password has been reset on server $(hostname). Please log in and change your password immediately.
Your current password is: ${NEWPASS}
Password Change TimeStamp: ${timestamp}
Script name: ${sname}
EOF
        exit 0
        fi
        ;;
        'AIX')
        grep ${CURUSER} /etc/passwd 1>/dev/null 2>&1
        if [ $? != 0 ];then
        echo " `hostname`,UserID does not exist on the system"
        exit 0
        else
        echo "${CURUSER}:${NEWPASS}" | chpasswd 1>/dev/null 2>&1
        chsec -f /etc/security/lastlog -a "unsuccessful_login_count=0" -s ${CURUSER} 1>/                                                                                                      dev/null 2>&1
        echo " `hostname`,Password Changed Successfully"
        exit 0
        fi
        ;;
        'SunOS')
        grep ${CURUSER} /etc/passwd 1>/dev/null 2>&1
        if [ $? != 0 ];then
        echo " `hostname`,UserID does not exist on the system"
        exit 0
        else
        setpwd -u ${CURUSER} -p ${NEWPASS}
        echo " `hostname`,Password Changed Successfully"
        exit 0
        fi
        ;;
esac
